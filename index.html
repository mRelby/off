<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>3D Манекен - Упрощенная версия</title>
    <style>
        body {
            margin: 0;
            overflow: hidden;
            display: flex;
            font-family: Arial, sans-serif;
        }
        
        #scene-container {
            flex: 1;
        }
        
        #controls {
            width: 300px;
            background: white;
            padding: 15px;
            overflow-y: auto;
            height: 100vh;
            box-shadow: -5px 0 15px rgba(0,0,0,0.1);
        }
        
        h2, h3 {
            margin-top: 15px;
            margin-bottom: 10px;
        }
        
        .control-group {
            margin-bottom: 20px;
        }
        
        .slider-control {
            margin-bottom: 10px;
        }
        
        label {
            display: block;
            margin-bottom: 5px;
        }
        
        button {
            background: #4285f4;
            color: white;
            border: none;
            padding: 8px 12px;
            margin: 5px;
            border-radius: 4px;
            cursor: pointer;
        }
        
        button:hover {
            background: #3b78e7;
        }
    </style>
</head>
<body>
    <div id="scene-container"></div>
    
    <div id="controls">
        <h2>Управление манекеном</h2>
        
        <div class="control-group">
            <h3>Пресеты поз</h3>
            <button id="reset-pose">По умолчанию</button>
            <button id="pose-a">Поза A</button>
            <button id="pose-b">Поза B</button>
        </div>
        
        <div class="control-group">
            <h3>Голова</h3>
            <div class="slider-control">
                <label for="head-y">Поворот головы (лево-право)</label>
                <input type="range" id="head-y" min="-90" max="90" value="0">
            </div>
            <div class="slider-control">
                <label for="head-x">Наклон головы (вверх-вниз)</label>
                <input type="range" id="head-x" min="-45" max="45" value="0">
            </div>
        </div>
        
        <div class="control-group">
            <h3>Руки</h3>
            <div class="slider-control">
                <label for="left-arm-y">Левая рука (подъем)</label>
                <input type="range" id="left-arm-y" min="-180" max="180" value="0">
            </div>
            <div class="slider-control">
                <label for="left-elbow">Левый локоть (сгиб)</label>
                <input type="range" id="left-elbow" min="0" max="160" value="0">
            </div>
            <div class="slider-control">
                <label for="right-arm-y">Правая рука (подъем)</label>
                <input type="range" id="right-arm-y" min="-180" max="180" value="0">
            </div>
            <div class="slider-control">
                <label for="right-elbow">Правый локоть (сгиб)</label>
                <input type="range" id="right-elbow" min="0" max="160" value="0">
            </div>
        </div>
        
        <div class="control-group">
            <h3>Ноги</h3>
            <div class="slider-control">
                <label for="left-leg-y">Левая нога (подъем)</label>
                <input type="range" id="left-leg-y" min="-90" max="90" value="0">
            </div>
            <div class="slider-control">
                <label for="left-knee">Левое колено (сгиб)</label>
                <input type="range" id="left-knee" min="0" max="160" value="0">
            </div>
            <div class="slider-control">
                <label for="right-leg-y">Правая нога (подъем)</label>
                <input type="range" id="right-leg-y" min="-90" max="90" value="0">
            </div>
            <div class="slider-control">
                <label for="right-knee">Правое колено (сгиб)</label>
                <input type="range" id="right-knee" min="0" max="160" value="0">
            </div>
        </div>
    </div>

    <!-- Загрузка последней версии Three.js -->
    <script src="https://cdn.jsdelivr.net/npm/three@0.160.0/build/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.160.0/examples/js/controls/OrbitControls.js"></script>

    <script>
        // Основные переменные Three.js
        let scene, camera, renderer, controls;
        
        // Части манекена
        let mannequin = {
            torso: null,
            head: null,
            leftArm: null, 
            leftForearm: null,
            rightArm: null,
            rightForearm: null,
            leftLeg: null,
            leftCalf: null,
            rightLeg: null,
            rightCalf: null
        };
        
        // Цвета
        const BODY_COLOR = 0x6495ED; // Более яркий синий цвет
        const JOINT_COLOR = 0x333333;
        
        // Инициализация сцены
        function init() {
            // Создание сцены
            scene = new THREE.Scene();
            scene.background = new THREE.Color(0xf0f0f0);
            
            // Создание камеры
            camera = new THREE.PerspectiveCamera(
                50, 
                window.innerWidth / (window.innerHeight), 
                0.1, 
                1000
            );
            camera.position.set(0, 1.7, 5);
            camera.lookAt(0, 1, 0);
            
            // Создание рендерера
            const container = document.getElementById('scene-container');
            renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setPixelRatio(window.devicePixelRatio);
            renderer.setSize(container.clientWidth, container.clientHeight);
            renderer.shadowMap.enabled = true;
            container.appendChild(renderer.domElement);
            
            // Добавление орбитальных контролей
            controls = new THREE.OrbitControls(camera, renderer.domElement);
            controls.target.set(0, 1, 0);
            controls.update();
            
            // Добавление света
            const ambientLight = new THREE.AmbientLight(0xffffff, 0.7);
            scene.add(ambientLight);
            
            const directionalLight = new THREE.DirectionalLight(0xffffff, 0.8);
            directionalLight.position.set(1, 2, 3);
            directionalLight.castShadow = true;
            scene.add(directionalLight);
            
            // Добавление пола
            const floor = new THREE.Mesh(
                new THREE.PlaneGeometry(10, 10),
                new THREE.MeshStandardMaterial({ color: 0xeeeeee })
            );
            floor.rotation.x = -Math.PI / 2;
            floor.position.y = 0;
            floor.receiveShadow = true;
            scene.add(floor);
            
            // Создание манекена
            createMannequin();
            
            // Настройка элементов управления
            setupControls();
            
            // Обработчик изменения размеров окна
            window.addEventListener('resize', onWindowResize);
            
            // Запуск анимации
            animate();
            
            // Добавим вспомогательные оси, чтобы было легче ориентироваться
            const axesHelper = new THREE.AxesHelper(1);
            scene.add(axesHelper);
        }
        
        // Создание манекена
        function createMannequin() {
            // Материалы
            const bodyMaterial = new THREE.MeshStandardMaterial({
                color: BODY_COLOR,
                roughness: 0.5,
                metalness: 0.1
            });
            
            const jointMaterial = new THREE.MeshStandardMaterial({
                color: JOINT_COLOR,
                roughness: 0.3,
                metalness: 0.2
            });
            
            // Создание торса (основа всей фигуры)
            mannequin.torso = new THREE.Group();
            
            // Для торса используем Box вместо CapsuleGeometry на всякий случай
            const torsoMesh = new THREE.Mesh(
                new THREE.BoxGeometry(0.4, 0.6, 0.2),
                bodyMaterial
            );
            torsoMesh.position.y = 0.3;
            torsoMesh.castShadow = true;
            mannequin.torso.add(torsoMesh);
            
            // Добавляем торс на сцену
            mannequin.torso.position.y = 1;
            scene.add(mannequin.torso);
            
            // Создание головы
            mannequin.head = new THREE.Group();
            
            // Шея (соединение)
            const neckJoint = new THREE.Mesh(
                new THREE.SphereGeometry(0.06, 16, 16),
                jointMaterial
            );
            mannequin.head.add(neckJoint);
            
            // Голова
            const headMesh = new THREE.Mesh(
                new THREE.SphereGeometry(0.15, 24, 24),
                bodyMaterial
            );
            headMesh.position.y = 0.15;
            headMesh.castShadow = true;
            mannequin.head.add(headMesh);
            
            mannequin.head.position.y = 0.6;
            mannequin.torso.add(mannequin.head);
            
            // Создание левой руки
            mannequin.leftArm = new THREE.Group();
            
            // Плечевой сустав
            const leftShoulderJoint = new THREE.Mesh(
                new THREE.SphereGeometry(0.06, 16, 16),
                jointMaterial
            );
            mannequin.leftArm.add(leftShoulderJoint);
            
            // Верхняя часть руки
            const leftUpperArm = new THREE.Mesh(
                new THREE.BoxGeometry(0.08, 0.3, 0.08),
                bodyMaterial
            );
            leftUpperArm.position.y = -0.15;
            leftUpperArm.castShadow = true;
            mannequin.leftArm.add(leftUpperArm);
            
            // Левое предплечье
            mannequin.leftForearm = new THREE.Group();
            
            // Локтевой сустав
            const leftElbowJoint = new THREE.Mesh(
                new THREE.SphereGeometry(0.05, 16, 16),
                jointMaterial
            );
            mannequin.leftForearm.add(leftElbowJoint);
            
            // Предплечье
            const leftForearmMesh = new THREE.Mesh(
                new THREE.BoxGeometry(0.07, 0.3, 0.07),
                bodyMaterial
            );
            leftForearmMesh.position.y = -0.15;
            leftForearmMesh.castShadow = true;
            mannequin.leftForearm.add(leftForearmMesh);
            
            mannequin.leftForearm.position.y = -0.3;
            mannequin.leftArm.add(mannequin.leftForearm);
            
            mannequin.leftArm.position.set(0.25, 0.5, 0);
            mannequin.torso.add(mannequin.leftArm);
            
            // Создание правой руки (аналогично левой)
            mannequin.rightArm = new THREE.Group();
            
            const rightShoulderJoint = new THREE.Mesh(
                new THREE.SphereGeometry(0.06, 16, 16),
                jointMaterial
            );
            mannequin.rightArm.add(rightShoulderJoint);
            
            const rightUpperArm = new THREE.Mesh(
                new THREE.BoxGeometry(0.08, 0.3, 0.08),
                bodyMaterial
            );
            rightUpperArm.position.y = -0.15;
            rightUpperArm.castShadow = true;
            mannequin.rightArm.add(rightUpperArm);
            
            mannequin.rightForearm = new THREE.Group();
            
            const rightElbowJoint = new THREE.Mesh(
                new THREE.SphereGeometry(0.05, 16, 16),
                jointMaterial
            );
            mannequin.rightForearm.add(rightElbowJoint);
            
            const rightForearmMesh = new THREE.Mesh(
                new THREE.BoxGeometry(0.07, 0.3, 0.07),
                bodyMaterial
            );
            rightForearmMesh.position.y = -0.15;
            rightForearmMesh.castShadow = true;
            mannequin.rightForearm.add(rightForearmMesh);
            
            mannequin.rightForearm.position.y = -0.3;
            mannequin.rightArm.add(mannequin.rightForearm);
            
            mannequin.rightArm.position.set(-0.25, 0.5, 0);
            mannequin.torso.add(mannequin.rightArm);
            
            // Создание левой ноги
            mannequin.leftLeg = new THREE.Group();
            
            const leftHipJoint = new THREE.Mesh(
                new THREE.SphereGeometry(0.06, 16, 16),
                jointMaterial
            );
            mannequin.leftLeg.add(leftHipJoint);
            
            const leftThigh = new THREE.Mesh(
                new THREE.BoxGeometry(0.1, 0.35, 0.1),
                bodyMaterial
            );
            leftThigh.position.y = -0.2;
            leftThigh.castShadow = true;
            mannequin.leftLeg.add(leftThigh);
            
            mannequin.leftCalf = new THREE.Group();
            
            const leftKneeJoint = new THREE.Mesh(
                new THREE.SphereGeometry(0.05, 16, 16),
                jointMaterial
            );
            mannequin.leftCalf.add(leftKneeJoint);
            
            const leftCalfMesh = new THREE.Mesh(
                new THREE.BoxGeometry(0.09, 0.35, 0.09),
                bodyMaterial
            );
            leftCalfMesh.position.y = -0.2;
            leftCalfMesh.castShadow = true;
            mannequin.leftCalf.add(leftCalfMesh);
            
            mannequin.leftCalf.position.y = -0.4;
            mannequin.leftLeg.add(mannequin.leftCalf);
            
            mannequin.leftLeg.position.set(0.1, -0.3, 0);
            mannequin.torso.add(mannequin.leftLeg);
            
            // Создание правой ноги (аналогично левой)
            mannequin.rightLeg = new THREE.Group();
            
            const rightHipJoint = new THREE.Mesh(
                new THREE.SphereGeometry(0.06, 16, 16),
                jointMaterial
            );
            mannequin.rightLeg.add(rightHipJoint);
            
            const rightThigh = new THREE.Mesh(
                new THREE.BoxGeometry(0.1, 0.35, 0.1),
                bodyMaterial
            );
            rightThigh.position.y = -0.2;
            rightThigh.castShadow = true;
            mannequin.rightLeg.add(rightThigh);
            
            mannequin.rightCalf = new THREE.Group();
            
            const rightKneeJoint = new THREE.Mesh(
                new THREE.SphereGeometry(0.05, 16, 16),
                jointMaterial
            );
            mannequin.rightCalf.add(rightKneeJoint);
            
            const rightCalfMesh = new THREE.Mesh(
                new THREE.BoxGeometry(0.09, 0.35, 0.09),
                bodyMaterial
            );
            rightCalfMesh.position.y = -0.2;
            rightCalfMesh.castShadow = true;
            mannequin.rightCalf.add(rightCalfMesh);
            
            mannequin.rightCalf.position.y = -0.4;
            mannequin.rightLeg.add(mannequin.rightCalf);
            
            mannequin.rightLeg.position.set(-0.1, -0.3, 0);
            mannequin.torso.add(mannequin.rightLeg);
        }
        
        // Настройка слайдеров управления
        function setupControls() {
            // Слайдеры для головы
            document.getElementById('head-y').addEventListener('input', function() {
                mannequin.head.rotation.y = THREE.MathUtils.degToRad(this.value);
            });
            
            document.getElementById('head-x').addEventListener('input', function() {
                mannequin.head.rotation.x = THREE.MathUtils.degToRad(this.value);
            });
            
            // Слайдеры для рук
            document.getElementById('left-arm-y').addEventListener('input', function() {
                mannequin.leftArm.rotation.x = THREE.MathUtils.degToRad(-this.value);
            });
            
            document.getElementById('left-elbow').addEventListener('input', function() {
                mannequin.leftForearm.rotation.x = THREE.MathUtils.degToRad(this.value);
            });
            
            document.getElementById('right-arm-y').addEventListener('input', function() {
                mannequin.rightArm.rotation.x = THREE.MathUtils.degToRad(-this.value);
            });
            
            document.getElementById('right-elbow').addEventListener('input', function() {
                mannequin.rightForearm.rotation.x = THREE.MathUtils.degToRad(this.value);
            });
            
            // Слайдеры для ног
            document.getElementById('left-leg-y').addEventListener('input', function() {
                mannequin.leftLeg.rotation.x = THREE.MathUtils.degToRad(this.value);
            });
            
            document.getElementById('left-knee').addEventListener('input', function() {
                mannequin.leftCalf.rotation.x = THREE.MathUtils.degToRad(this.value);
            });
            
            document.getElementById('right-leg-y').addEventListener('input', function() {
                mannequin.rightLeg.rotation.x = THREE.MathUtils.degToRad(this.value);
            });
            
            document.getElementById('right-knee').addEventListener('input', function() {
                mannequin.rightCalf.rotation.x = THREE.MathUtils.degToRad(this.value);
            });
            
            // Кнопки пресетов
            document.getElementById('reset-pose').addEventListener('click', function() {
                resetPose();
            });
            
            document.getElementById('pose-a').addEventListener('click', function() {
                applyPose({
                    headX: 20,
                    headY: 15,
                    leftArmY: -45,
                    leftElbow: 90,
                    rightArmY: -45,
                    rightElbow: 90,
                    leftLegY: 0,
                    leftKnee: 10,
                    rightLegY: 0,
                    rightKnee: 10
                });
            });
            
            document.getElementById('pose-b').addEventListener('click', function() {
                applyPose({
                    headX: -10,
                    headY: -30,
                    leftArmY: -90,
                    leftElbow: 30,
                    rightArmY: -180,
                    rightElbow: 40,
                    leftLegY: 45,
                    leftKnee: 90,
                    rightLegY: 10,
                    rightKnee: 30
                });
            });
        }
        
        // Сброс позы
        function resetPose() {
            applyPose({
                headX: 0,
                headY: 0,
                leftArmY: 0,
                leftElbow: 0,
                rightArmY: 0,
                rightElbow: 0,
                leftLegY: 0,
                leftKnee: 0,
                rightLegY: 0,
                rightKnee: 0
            });
        }
        
        // Применение пресета позы
        function applyPose(pose) {
            // Голова
            mannequin.head.rotation.x = THREE.MathUtils.degToRad(pose.headX);
            mannequin.head.rotation.y = THREE.MathUtils.degToRad(pose.headY);
            
            // Руки
            mannequin.leftArm.rotation.x = THREE.MathUtils.degToRad(-pose.leftArmY);
            mannequin.leftForearm.rotation.x = THREE.MathUtils.degToRad(pose.leftElbow);
            mannequin.rightArm.rotation.x = THREE.MathUtils.degToRad(-pose.rightArmY);
            mannequin.rightForearm.rotation.x = THREE.MathUtils.degToRad(pose.rightElbow);
            
            // Ноги
            mannequin.leftLeg.rotation.x = THREE.MathUtils.degToRad(pose.leftLegY);
            mannequin.leftCalf.rotation.x = THREE.MathUtils.degToRad(pose.leftKnee);
            mannequin.rightLeg.rotation.x = THREE.MathUtils.degToRad(pose.rightLegY);
            mannequin.rightCalf.rotation.x = THREE.MathUtils.degToRad(pose.rightKnee);
            
            // Обновление значений слайдеров
            document.getElementById('head-x').value = pose.headX;
            document.getElementById('head-y').value = pose.headY;
            document.getElementById('left-arm-y').value = pose.leftArmY;
            document.getElementById('left-elbow').value = pose.leftElbow;
            document.getElementById('right-arm-y').value = pose.rightArmY;
            document.getElementById('right-elbow').value = pose.rightElbow;
            document.getElementById('left-leg-y').value = pose.leftLegY;
            document.getElementById('left-knee').value = pose.leftKnee;
            document.getElementById('right-leg-y').value = pose.rightLegY;
            document.getElementById('right-knee').value = pose.rightKnee;
        }
        
        // Обработчик изменения размеров окна
        function onWindowResize() {
            const container = document.getElementById('scene-container');
            camera.aspect = container.clientWidth / container.clientHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(container.clientWidth, container.clientHeight);
        }
        
        // Анимационный цикл
        function animate() {
            requestAnimationFrame(animate);
            controls.update();
            renderer.render(scene, camera);
        }
        
        // Запускаем инициализацию
        window.addEventListener('load', init);
    </script>
</body>
</html>
